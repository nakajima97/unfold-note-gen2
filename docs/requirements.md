# 要件定義書
## 1. はじめに
### 1.1 目的
このドキュメントは、このリポジトリで開発を進めているアプリの要件を定義します。  
アプリ名は"Unfold Note"です。  

### 1.2 対象読者
- 開発チーム
- プロジェクト管理者
- テスト担当者
- その他の利害関係者

### 1.3 このシステムが解決したい課題
- 雑にメモを保存しても必要な情報が埋もれることないようにしたい

### 1.4 1.3の解決策
- 書くのが簡単なマークダウン記法を使ってメモを作成できるようにする
- フォルダなどの階層構造を作成しない
- タグを使ってメモ同士のつながりを表現する

## 2. 機能要件

### 2.1 ユーザー管理
- **ユーザー登録**: 管理者によって承認されたメールアドレスのみが登録可能
- **ユーザー認証**: Google OAuthを使用したログイン
  - 例外として環境変数によってID/パスワードでのログインも可能
  - ローカルでの開発をスムーズにすすめるための対処
- **ユーザープロファイル**: 表示名などの基本情報の管理

### 2.2 プロジェクト管理
- **プロジェクト作成**: ユーザーは複数のプロジェクトを作成可能
- **プロジェクト編集**: プロジェクト名の変更
- **プロジェクトアーカイブ**: 使用しないプロジェクトのアーカイブ
- **プロジェクト削除**: 不要なプロジェクトの削除

### 2.3 ノート管理
- **ノート作成**: マークダウン形式でのノート作成
- **ノート編集**: 既存ノートの編集
- **ノート削除**: 不要なノートの削除
- **ノート一覧表示**: プロジェクト内のノート一覧の表示
- **ノート検索**: タイトルや内容による検索
- **メディアの追加**: ノート内に画像やファイルを追加

### 2.4 タグ機能
- **タグ付け**: ノート内に `#タグ名` を記述することでタグ付け
- **タグ抽出**: ノートの作成・更新時に自動的にタグを抽出し、データベースに保存
- **タグ検索**: 特定のタグが付けられたノートの検索
- **タグ一覧**: 使用されているタグの一覧表示
- **タグ提案**: 既存のタグに基づく入力候補の表示
- **タグナビゲーション**: 同じタグを持つノート間のナビゲーション
- **タグ関連表示**: ノートに関連するタグの一覧表示
- **タグハイライト**: ノート内のタグを視覚的に強調表示
- **タグ参照検出**: 存在しないタグへの参照の検出と表示

### 2.5 UI/UX要件
- **レスポンシブデザイン**: 様々なデバイスでの使用に対応
- **ダークモード**: 明暗切り替え機能
- **キーボードショートカット**: 効率的な操作のためのショートカット
- **ドラッグ&ドロップ**: 直感的なノート整理

### 2.6 マークダウン機能
- **基本マークダウン**: 見出し、リスト、太字、斜体、引用などの基本的なマークダウン記法のサポート
- **コードブロック**: シンタックスハイライト付きのコードブロック
- **数式**: LaTeX形式の数式表示
- **チェックボックス**: タスク管理のためのチェックボックス
- **テーブル**: 表形式データの表示
- **リアルタイムプレビュー**: 編集中のマークダウンのリアルタイム表示

### 2.7 データ管理
- **自動保存**: 編集内容の自動保存
- **バージョン履歴**: ノートの変更履歴の保存と閲覧
- **エクスポート**: マークダウン、PDF、HTMLなどの形式でのエクスポート
- **インポート**: 外部ファイルからのインポート

## 3. 非機能要件

### 3.1 パフォーマンス要件
- **応答時間**: ページロードは2秒以内、操作応答は0.5秒以内
- **同時接続**: 最大100ユーザーの同時接続をサポート
- **スケーラビリティ**: ユーザー数やデータ量の増加に対応できる設計

### 3.2 セキュリティ要件
- **データ暗号化**: 保存データの暗号化
- **セキュアな通信**: HTTPSによる通信
- **認証**: 安全な認証メカニズム
- **アクセス制御**: 適切な権限管理
- **脆弱性対策**: XSS、CSRF、SQLインジェクションなどへの対策

### 3.3 可用性要件
- **稼働時間**: 99.9%以上の稼働率（計画メンテナンス除く）
- **バックアップ**: 定期的なデータバックアップ
- **障害復旧**: 障害発生時の迅速な復旧手順

### 3.4 互換性要件
- **ブラウザ互換性**: 最新のChrome、Firefox、Safari、Edgeをサポート
- **デバイス互換性**: デスクトップ、タブレット、モバイルデバイスでの動作

## 4. データモデル

### 4.1 ユーザーモデル
```
User {
  id: string (primary key)
  email: string
  displayName: string
  avatarUrl: string (optional)
  createdAt: timestamp
  updatedAt: timestamp
}
```

### 4.2 プロジェクトモデル
```
Project {
  id: string (primary key)
  name: string
  description: string (optional)
  ownerId: string (foreign key -> User.id)
  isArchived: boolean
  createdAt: timestamp
  updatedAt: timestamp
}
```

### 4.3 ノートモデル
```
Note {
  id: string (primary key)
  title: string
  content: string (markdown)
  projectId: string (foreign key -> Project.id)
  createdAt: timestamp
  updatedAt: timestamp
}
```

### 4.4 タグモデル
```
Tag {
  id: string (primary key)
  name: string
  projectId: string (foreign key -> Project.id)
  createdAt: timestamp
}
```

### 4.5 ノートタグ関連モデル
```
NoteTag {
  noteId: string (foreign key -> Note.id)
  tagId: string (foreign key -> Tag.id)
  primary key (noteId, tagId)
}
```

## 5. 技術スタック

### 5.1 フロントエンド
- **フレームワーク**: Next.js
- **言語**: TypeScript
- **スタイリング**: Tailwind CSS
- **状態管理**: React Query, Context API
- **マークダウンレンダリング**: react-markdown
- **エディタ**: CodeMirror または Monaco Editor

### 5.2 バックエンド
- **BaaS**: Supabase
- **データベース**: Supabase Database
- **認証**: Supabase Authentication

### 5.3 インフラストラクチャ
- **ホスティング**: Vercel
- **データベースホスティング**: Supabase
- **ストレージ**: Supabase Storage
- **CDN**: Vercel Edge Network

## 6. 実装ガイドライン

### 6.1 コーディング規約
- TypeScriptの型定義を厳格に行う
- ESLintとPrettierを使用したコード品質の維持
- コンポーネント設計はアトミックデザインパターンに従う
- テスト駆動開発（TDD）の採用

### 6.2 ディレクトリ構造
```
/
├── frontend/
│   ├── src/
│   │   ├── app/          # Next.js App Router
│   │   ├── components/   # UIコンポーネント
│   │   ├── hooks/        # カスタムフック
│   │   ├── lib/          # ユーティリティ関数
│   │   ├── services/     # APIサービス
│   │   └── types/        # 型定義
│   ├── public/           # 静的ファイル
│   └── ...
├── backend/              # 必要に応じて別サービスとして実装
│   ├── src/
│   │   ├── controllers/  # APIコントローラー
│   │   ├── models/       # データモデル
│   │   ├── routes/       # APIルート
│   │   └── services/     # ビジネスロジック
│   └── ...
└── docs/                 # プロジェクトドキュメント
```

### 6.3 開発フロー
- Gitブランチ戦略: GitHub Flow
- プルリクエスト必須
  - レビューは一人で開発しているため不要
- CIパイプラインによる自動テスト
- セマンティックバージョニングの採用

### 6.4 テスト戦略
- ユニットテスト: Vitest
- コンポーネントテスト: React Testing Library
- E2Eテスト: Cypress
- テストカバレッジ目標: 80%以上

## 7. マイルストーンとリリース計画

### 7.1 フェーズ1: MVP（最小実用製品）
- 基本的なユーザー認証
- プロジェクト作成・管理
- 基本的なノート作成・編集機能
- シンプルなタグ機能

### 7.2 フェーズ2: 機能拡張
- 高度なマークダウン機能
- タグナビゲーションの強化
- 検索機能の強化
- エクスポート・インポート機能

### 7.3 フェーズ3: 洗練と最適化
- UI/UXの改善
- パフォーマンス最適化
- モバイル対応の強化
- 追加機能の実装

## 8. 用語集
- **ノート**: マークダウン形式で作成されるドキュメント
- **プロジェクト**: ノートを整理するためのコンテナ
- **タグ**: ノートを分類・関連付けるためのキーワード
- **マークダウン**: テキストを構造化するための軽量マークアップ言語

## 8. 付録

### 8.1 参考資料
- マークダウン仕様: [CommonMark](https://commonmark.org/)
- Next.js ドキュメント: [Next.js](https://nextjs.org/docs)

### 8.2 UI/UXデザイン参考
- 基本的なカラーパレット: ダークモード/ライトモード対応
- フォント: システムフォントスタック（読みやすさ重視）
- アイコン: Heroicons または Material Icons
